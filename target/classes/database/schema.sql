DROP TABLE IF EXISTS USERS;

CREATE TABLE  "USERS" (
    "USER_ID" IDENTITY NOT NULL PRIMARY KEY,
	"USERNAME" VARCHAR2(64) NOT NULL,
	"EMAIL" VARCHAR2(254) NOT NULL,
    "PASSWORD" VARCHAR2(512) NOT NULL
);

DROP TABLE IF EXISTS TIPOS;

CREATE TABLE "TIPOS" (
    "TIPO_ID" IDENTITY NOT NULL PRIMARY KEY,
    "NOMBRE" VARCHAR2(64) NOT NULL,
    "USER_ID" INTEGER NOT NULL
);

ALTER TABLE TIPOS ADD CONSTRAINT FK_TYPE_USER
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) 
    ON DELETE CASCADE;

DROP TABLE IF EXISTS ORIGINS;

CREATE TABLE "ORIGINS" (
    "ORIGIN_ID" IDENTITY NOT NULL PRIMARY KEY,
    "NOMBRE" VARCHAR2(64) NOT NULL,
    "USER_ID" INTEGER NOT NULL
);

ALTER TABLE ORIGINS ADD CONSTRAINT FK_ORIGIN_USER 
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) 
    ON DELETE CASCADE;

DROP TABLE IF EXISTS WINES;

CREATE TABLE  "WINES" (
    "WINE_ID" IDENTITY NOT NULL PRIMARY KEY,
	"NOMBRE" VARCHAR2(64) NOT NULL,
	"DESCRIPTION" VARCHAR2(254),
    "QUANTITY" INTEGER,
    "PURCHASE_PRICE" NUMERIC,
    "LOCATION" VARCHAR2(254),
    "FROM_YEAR" INTEGER,
    "RATING" INTEGER,
    "TIPO_ID" INTEGER NOT NULL,
    "ORIGIN_ID" INTEGER NOT NULL,
    "USER_ID" INTEGER NOT NULL
);

ALTER TABLE WINES ADD CONSTRAINT FK_WINE_USER 
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) 
    ON DELETE CASCADE;

ALTER TABLE WINES ADD CONSTRAINT FK_WINE_ORIGIN
    FOREIGN KEY (ORIGIN_ID) REFERENCES ORIGINS(ORIGIN_ID)
    ON DELETE CASCADE;

ALTER TABLE WINES ADD CONSTRAINT FK_WINE_TYPE 
    FOREIGN KEY (TIPO_ID) REFERENCES TIPOS(TIPO_ID)
    ON DELETE CASCADE;

DROP TABLE IF EXISTS PURCHASE;

CREATE TABLE "PURCHASE" (
    "PURCHASE_ID" IDENTITY NOT NULL PRIMARY KEY,
    "COUNT" INTEGER NOT NULL,
    "WINE_ID" INTEGER NOT NULL,
    "USER_ID" INTEGER NOT NULL
);

ALTER TABLE PURCHASE ADD CONSTRAINT FK_PURCHASE_USER
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) 
    ON DELETE CASCADE;

ALTER TABLE PURCHASE ADD CONSTRAINT FK_PURCHASE_WINE 
    FOREIGN KEY (WINE_ID) REFERENCES WINES(WINE_ID) 
    ON DELETE CASCADE;